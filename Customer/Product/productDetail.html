<!DOCTYPE html>
<html lang="zxx">
  <head>
    <common-css></common-css>
    <script src="../../js/common.js"></script>
    <common-header></common-header>
  </head>

  <body>
    <!-- Shop Details Section Begin -->
    <section class="shop-details">
      <div class="product__details__pic">
        <div class="container">
          <div class="row">
            <div class="col-lg-12">
              <div class="product__details__breadcrumb">
                <a href="../HomePage/Index.html">Home</a>
                <a href="../Product/productList.html">Shop</a>
                <span>Product Details</span>
              </div>
            </div>
          </div>
          <div class="row">
            <div style="margin: auto">
              <div class="tab-content">
                <div class="tab-pane active" id="tabs-1" role="tabpanel">
                  <div class="product__details__pic__item" id="product-image">
                    <img
                      src="../../img/shop-details/product-big-2.png"
                      alt=""
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="product__details__content">
        <div class="container">
          <div class="row d-flex justify-content-center">
            <div class="col-lg-8">
              <div class="product__details__text">
                <h4 id="product-name">Hooded thermal anorak</h4>

                <h3 id="product-price">$0</h3>
                <p id="product-subdescription">
                  Coat with quilted lining and an adjustable hood. Featuring
                  long sleeves with adjustable cuff tabs, adjustable asymmetric
                  hem with elastic side tabs and a front zip fastening with
                  placket.
                </p>
                <div class="product__details__option">
                  <div class="product__details__option__size" id="product-size">
                    <span>Size:</span>
                    <label for="xxl"
                      >xxl
                      <input type="radio" id="xxl" />
                    </label>
                    <label class="active" for="xl"
                      >xl
                      <input type="radio" id="xl" />
                    </label>
                    <label for="l"
                      >l
                      <input type="radio" id="l" />
                    </label>
                    <label for="sm"
                      >s
                      <input type="radio" id="sm" />
                    </label>
                  </div>
                  <div
                    class="product__details__option__color"
                    id="product-color"
                  >
                    <span>Color:</span>
                    <label class="c-1" for="sp-1">
                      <input type="radio" id="sp-1" />
                    </label>
                    <label class="c-2" for="sp-2">
                      <input type="radio" id="sp-2" />
                    </label>
                    <label class="c-3" for="sp-3">
                      <input type="radio" id="sp-3" />
                    </label>
                    <label class="c-4" for="sp-4">
                      <input type="radio" id="sp-4" />
                    </label>
                    <label class="c-9" for="sp-9">
                      <input type="radio" id="sp-9" />
                    </label>
                  </div>
                </div>
                <div class="product__details__cart__option">
                  <div class="quantity">
                    <div class="pro-qty">
                      <input type="text" value="1" id="quantity" />
                    </div>
                  </div>
                  <a href="#" class="primary-btn">add to cart</a>
                </div>

                <div class="product__details__last__option">
                  <ul>
                    <li>
                      <span>SKU:</span> <span id="product-id">12221</span>
                    </li>
                    <span style="display: inline"
                      >Categories:
                      <li id="category" value="" style="display: inline"></li
                    ></span>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="product__details__tab">
                <ul class="nav nav-tabs" role="tablist">
                  <li class="nav-item">
                    <a
                      class="nav-link active"
                      data-toggle="tab"
                      href="#tabs-5"
                      role="tab"
                      >Description</a
                    >
                  </li>
                </ul>
                <div class="tab-content">
                  <div class="tab-pane active" id="tabs-5" role="tabpanel">
                    <div
                      class="product__details__tab__content"
                      id="product-description"
                    >
                      A Pocket PC is a handheld computer, which features many of
                      the same capabilities as a modern PC. As is the case with
                      any new technology product, the cost of a Pocket PC was
                      substantial during itâ€™s early release. Lorem ipsum dolor
                      sit amet, consectetur adipisicing elit. Laboriosam
                      reiciendis aut, distinctio non explicabo minima ullam
                      iusto beatae aliquam facere assumenda quia, repudiandae
                      et. Mollitia beatae ipsum dolore eos quis!
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      (async function productDetail() {
        // Láº¥y URL hiá»‡n táº¡i
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");

        try {
          const response = await fetch(
            `http://localhost:4001/api/products/${id}`,
            {
              method: "GET",
              headers: {
                "Content-Type": "application/json",
              },
            }
          );

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          const data = await response.json();

          const product = data.product;

          // GÃ¡n dá»¯ liá»‡u tá»« response vÃ o cÃ¡c tháº» HTML tÆ°Æ¡ng á»©ng
          document.getElementById(
            "product-image"
          ).innerHTML = `<img src="${product.image}" alt="Product Image" style="height: 450px; width: 450px;">`;
          document.getElementById(
            "product-name"
          ).innerHTML = `<h4>${product.name}</h4>`;
          document.getElementById(
            "product-price"
          ).innerText = `$${product.price}`;
          document.getElementById(
            "category"
          ).innerText += ` ${product.category}`;
          document.getElementById("product-id").innerText = product._id;
          document.getElementById("product-description").innerText =
            product.description;

          document.getElementById("product-subdescription").innerText =
            product.subDescription;

          const colors = product.color; // Assuming product.color is an array of color codes

          const colorDiv = document.getElementById("product-color");
          // Clear the content in case there's any existing content
          colorDiv.innerHTML = "<span>Color:</span>";

          colors.forEach((colorCode) => {
            colorDiv.innerHTML += `
        <label class="color-label" style="background-color: ${colorCode};" for="sp-${colorCode}">
          <input type="radio" id="sp-${colorCode}" name="color" value="${colorCode}" />
        </label>
      `;
          });

          const sizes = product.size; // Assuming product.size is already an array

          const sizeDiv = document.getElementById("product-size");
          // Clear the content in case there's any existing content
          sizeDiv.innerHTML = "<span>Size:</span>";

          sizes.forEach((size) => {
            sizeDiv.innerHTML += `
              <label for="${size.toLowerCase()}"
                class="${size.toLowerCase() === "xl" ? "active" : ""}"
                onclick="selectSize(this)">
                ${size.toLowerCase()}
                <input type="radio" id="${size.toLowerCase()}" name="size" value="${size}"/>
              </label>
            `;
          });

          const addToCartButton = document.querySelector(".primary-btn");
          addToCartButton.addEventListener("click", async function (event) {
            event.preventDefault();

            const user = JSON.parse(localStorage.getItem("user"));
            console.log("ðŸš€ ~ file: productDetail.html:237 ~ user:", user._id);
            // Get selected values
            const selectedColor = document.querySelector(
              'input[name="color"]:checked'
            );

            const selectedSize = document.querySelector(
              'input[name="size"]:checked'
            );
            const quantity = document.getElementById("quantity").value;
            const productId = document.getElementById("product-id").innerText;
            const category = document.getElementById("category").innerText;

            // Check if values are selected
            if (!selectedColor || !selectedSize) {
              alert("Please select color and size before adding to cart.");
              return;
            }

            // Prepare data object
            const itemData = {
              color: selectedColor.value,
              size: selectedSize.value,
              quantity: quantity,
              _id: productId,
              category: category,
              userId: user._id,
            };

            // Send the data to the server (replace this with your actual endpoint)
            try {
              const response = await fetch("http://localhost:4001/api/carts", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(itemData),
              });
              console.log(
                "ðŸš€ ~ file: productDetail.html:273 ~ response:",
                response
              );

              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
            } catch (error) {
              console.error("An error occurred:", error);
            }
          });
        } catch (error) {
          console.error("An error occurred:", error);
        }
      })();
    </script>

    <script>
      function selectSize(label) {
        // Remove "active" class from all size labels
        console.log("Size label clicked:", label);
        document
          .querySelectorAll(".product__details__option__size label")
          .forEach((el) => {
            el.classList.remove("active");
          });

        // Add "active" class to the clicked label
        label.classList.add("active");
      }
    </script>

    <!-- Shop Details Section End -->
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery.nice-select.min.js"></script>
    <script src="/js/jquery.nicescroll.min.js"></script>
    <script src="/js/jquery.magnific-popup.min.js"></script>
    <script src="/js/jquery.countdown.min.js"></script>
    <script src="/js/jquery.slicknav.js"></script>
    <script src="/js/mixitup.min.js"></script>
    <script src="/js/owl.carousel.min.js"></script>
    <script src="/js/main.js"></script>
  </body>
  <footer>
    <common-footer></common-footer>
  </footer>
</html>
