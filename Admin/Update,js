document.addEventListener("DOMContentLoaded", async () => {
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get("id");
  const itemNameInput = document.getElementById("product-name");
  const itemCategoryInput = document.getElementById("product-category");
  const itemPriceInput = document.getElementById("product-price");
  const itemPromotionalPriceInput = document.getElementById(
    "product-promotional-price"
  );
  const itemDescriptionShortInput =
    document.getElementById("short-description");
  const itemDescriptionInput = document.getElementById("detail-description");
  const itemQuantityInput = document.getElementById("quantity");
  const itemImageInput = document.getElementById("image");
  const form = document.getElementById("Update-product");

  try {
    const response = await fetch(
      `https://web-api-5vrh.onrender.com/api/products/${id}`
    );

    if (!response.ok) {
      throw new Error("Unable to fetch data");
    }

    const data = await response.json();
    console.log(
      "üöÄ ~ file: Update,js:31 ~ document.addEventListener ~ data:",
      data.product
    );

    // Hi·ªÉn th·ªã th√¥ng tin item l√™n form
    itemNameInput.value = data.product.name;
    itemDescriptionInput.value = data.product.description;
    itemImageInput.value = data.product.image;
    itemQuantityInput.value = data.product.quantity;
    itemDescriptionShortInput.value = data.product.shortDescription;
    itemPriceInput.value = data.product.price;
    itemCategoryInput.value = data.product.category;
    itemPromotionalPriceInput.value = data.product.promotionalPrice;
    // C√°c tr∆∞·ªùng th√¥ng tin kh√°c c·ªßa item...
  } catch (error) {
    console.error("Error:", error);
  }

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    const updatedItem = {
      _id: id,
      name: itemNameInput.value,
      description: itemDescriptionInput.value,
      image: itemImageInput.value,
      quantity: itemQuantityInput.value,
      shortDescription: itemDescriptionShortInput.value,
      price: itemPriceInput.value,
      category: itemCategoryInput.value,
      promotionalPrice: itemPromotionalPriceInput.value,
    };

    try {
      const response = await fetch(
        `https://web-api-5vrh.onrender.com/api/products/${id}`,
        {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(updatedItem),
        }
      );

      if (!response.ok) {
        throw new Error("Unable to update data");
      }

      const data = await response.json();
      console.log("Item updated:", data);
      // X·ª≠ l√Ω sau khi c·∫≠p nh·∫≠t th√†nh c√¥ng
    } catch (error) {
      console.error("Error:", error);
    }
  });
});
function updateImageValue(inputElement) {
  var imageUrl = inputElement.value;
  var holder = document.getElementById('holder');
  holder.innerHTML = '<img src="' + imageUrl + '" style="max-height:100px;">';
}

function chooseImage() {
  var choice = prompt("Ch·ªçn 1 ƒë·ªÉ nh·∫≠p ƒë∆∞·ªùng d·∫´n h√¨nh ·∫£nh, ch·ªçn 2 ƒë·ªÉ ch·ªçn t·ªáp tin");
  if (choice === '1') {
      var imageUrl = prompt("Nh·∫≠p ƒë∆∞·ªùng d·∫´n h√¨nh ·∫£nh ho·∫∑c link"); 
      if (imageUrl !== null && imageUrl !== "") {
          document.getElementById('imageUrl').value = imageUrl;
          var holder = document.getElementById('holder');
          holder.innerHTML = '<img src="' + imageUrl + '" style="max-height:100px;">';
      }
  } else if (choice === '2') {
      document.getElementById('imageFile').click();
  }
}

function updateImageFileValue(inputElement) {
  var file = inputElement.files[0];
  var reader = new FileReader();

  reader.onload = function() {
      var imageUrl = reader.result;
      var holder = document.getElementById('holder');
      holder.innerHTML = '<img src="' + imageUrl + '" style="max-height:100px;">';
      document.getElementById('imageUrl').value = imageUrl;
  }

  reader.readAsDataURL(file);
}